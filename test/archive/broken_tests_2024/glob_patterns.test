# Test glob pattern functionality for AST functions

# Load the extension
statement ok
LOAD 'build/release/extension/duckdb_ast/duckdb_ast.duckdb_extension';

# Test 1: Single file should work
query I
SELECT COUNT(*) > 0 as has_nodes FROM read_ast('test/data/python/simple.py');
----
true

# Test 2: Glob pattern for Python files should find multiple files
query I
SELECT COUNT(*) > 100 as has_many_nodes FROM read_ast('test/data/python/*.py');
----
true

# Test 3: File list should work
query I
SELECT COUNT(*) > 50 as has_nodes FROM read_ast(['test/data/python/simple.py', 'test/data/python/decorators.py']);
----
true

# Test 4: ignore_errors should handle non-existent files gracefully
query I
SELECT COUNT(*) as file_count FROM read_ast('test/data/nonexistent/*.py', ignore_errors := true);
----
0

# Test 5: read_ast_objects should work with single file
query III
SELECT 
    LENGTH(ast.source.file_path) > 0 as has_file_path,
    LENGTH(ast.source.language) > 0 as has_language,
    LENGTH(ast.nodes) > 10 as has_many_nodes
FROM read_ast_objects('test/data/cpp/simple.cpp');
----
true	true	true

# Test 6: read_ast_objects should work with glob pattern (returns one row per file)
query I
SELECT COUNT(*) as file_count
FROM read_ast_objects('test/data/python/*.py');
----
7

# Test 7: ignore_errors should work with read_ast_objects too
query I
SELECT COUNT(*) as file_count
FROM read_ast_objects('nonexistent/*.cpp', ignore_errors := true);
----
0

# Test 8: Test that file lists with mixed languages work
query I
SELECT COUNT(*) > 50 as has_nodes FROM read_ast(['test/data/python/*.py', 'test/data/javascript/*.js']);
----
true

# Test 9: Verify language auto-detection works for different file types
query I
SELECT COUNT(DISTINCT file_path) >= 2 as found_multiple_files FROM read_ast('test/data/javascript/*.js');
----
true

# Test 10: Test recursive glob patterns
query I
SELECT COUNT(*) > 100 as has_nodes FROM read_ast('test/data/**/*.py');
----
true

# Test 11: Test syntax error handling with ignore_errors
query I
SELECT COUNT(*) > 0 as parsed_some_files FROM read_ast('test/data/python/*.py', ignore_errors := true);
----
true

# Test 12: Verify multi-language glob works with explicit language override
query I
SELECT COUNT(*) > 0 as has_nodes FROM read_ast('test/data/cpp/*.cpp', 'cpp');
----
true