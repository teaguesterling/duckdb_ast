# name: test/sql/file_extension_detection.test
# description: Test file extension auto-detection functionality
# group: [duckdb_ast]

require duckdb_ast

# Test 1: Python file auto-detection
# ==================================

statement ok
CREATE TEMP TABLE temp_py AS SELECT * FROM read_ast('test/data/python/simple.py') LIMIT 1;

query I
SELECT COUNT(*) > 0 FROM temp_py;
----
true

# Test 2: JavaScript file auto-detection  
# ======================================

statement ok
CREATE TEMP TABLE temp_js AS SELECT * FROM read_ast('test/data/javascript/simple.js') LIMIT 1;

query I
SELECT COUNT(*) > 0 FROM temp_js;
----
true

# Test 3: Go file auto-detection
# ==============================

statement ok
CREATE TEMP TABLE temp_go AS SELECT * FROM read_ast('test/data/go/simple.go') LIMIT 1;

query I
SELECT COUNT(*) > 0 FROM temp_go;
----
true

# Test 4: Explicit language specification matches auto-detection
# =============================================================

query I
SELECT 
    (SELECT COUNT(*) FROM read_ast('test/data/go/simple.go')) = 
    (SELECT COUNT(*) FROM read_ast('test/data/go/simple.go', 'go'));
----
true

# Test 5: Language consistency across calls
# =========================================

query I
WITH lang_detect AS (
    SELECT COUNT(*) as auto_count FROM read_ast('test/data/python/simple.py')
),
lang_explicit AS (
    SELECT COUNT(*) as explicit_count FROM read_ast('test/data/python/simple.py', 'python')
)
SELECT auto_count = explicit_count FROM lang_detect, lang_explicit;
----
true

# Test 6: Multiple file types in same query
# =========================================

query III
SELECT 
    'python' as lang,
    COUNT(*) as node_count,
    COUNT(*) > 0 as has_nodes
FROM read_ast('test/data/python/simple.py')
UNION ALL
SELECT 
    'go' as lang,
    COUNT(*) as node_count, 
    COUNT(*) > 0 as has_nodes
FROM read_ast('test/data/go/simple.go')
ORDER BY lang;
----
go	51	true
python	110	true